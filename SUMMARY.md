# Cross Staking Protocol - í”„ë¡œì íŠ¸ ìš”ì•½

## ğŸ¯ í”„ë¡œì íŠ¸ ê°œìš”

Cross Staking Protocolì€ Native CROSSì™€ ERC20 í† í°ì„ ìœ„í•œ **í™•ì¥ ê°€ëŠ¥í•œ ë‹¤ì¤‘ í’€ ìŠ¤í…Œì´í‚¹ ì‹œìŠ¤í…œ**ì…ë‹ˆë‹¤.

### í•µì‹¬ ê°€ì¹˜

- âœ… **ìœ ì—°ì„±**: Native CROSSì™€ ERC20 ëª¨ë‘ ì§€ì›
- âœ… **í™•ì¥ì„±**: ë¬´ì œí•œ í’€ ìƒì„± ê°€ëŠ¥
- âœ… **ê³µì •ì„±**: ì˜ˆì¹˜ ì‹œê°„ê³¼ ë¹„ìœ¨ì— ë”°ë¥¸ ì •í™•í•œ ë³´ìƒ ë¶„ë°°
- âœ… **íš¨ìœ¨ì„±**: O(1) ê°€ìŠ¤ ë¹„ìš©
- âœ… **ì•ˆì „ì„±**: ë‹¤ì¸µ ë³´ì•ˆ ë©”ì»¤ë‹ˆì¦˜ ë° ì—…ê·¸ë ˆì´ë“œ ê°€ëŠ¥

---

## ğŸ“ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### 4ê°œì˜ í•µì‹¬ ì»¨íŠ¸ë™íŠ¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ì‚¬ìš©ì (User)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ Native CROSS / ERC20
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      CrossStakingRouter                 â”‚
â”‚  (ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ - ì¬ë°°í¬ ê°€ëŠ¥)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€â”€â–º WCROSS (ë˜í•‘)
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         CrossStaking                     â”‚
â”‚    (í’€ ê´€ë¦¬ íŒ©í† ë¦¬ - UUPS)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ creates
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      CrossStakingPool Ã— n               â”‚
â”‚   (ê°œë³„ ìŠ¤í…Œì´í‚¹ í’€ - UUPS)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì»´í¬ë„ŒíŠ¸ ì„¤ëª…

#### 1. WCROSS
```solidity
// Native CROSS Wrapper
- deposit() / withdraw()  // Routerë§Œ ì‚¬ìš© ê°€ëŠ¥
- CrossStakingì´ ìƒì„±
- ERC20 í‘œì¤€ ì¤€ìˆ˜
```

#### 2. CrossStaking
```solidity
// í’€ ê´€ë¦¬ íŒ©í† ë¦¬ (UUPS Upgradeable)
- createPool()           // POOL_MANAGER_ROLE
- addRewardToken()       // POOL_MANAGER_ROLE
- setPoolActive()        // POOL_MANAGER_ROLE
- setRouter()            // DEFAULT_ADMIN_ROLE
```

#### 3. CrossStakingPool
```solidity
// ê°œë³„ ìŠ¤í…Œì´í‚¹ í’€ (UUPS Upgradeable)
- stake() / stakeFor()
- unstake() / unstakeFor()
- claimRewards() / claimReward()
- rewardPerToken ëˆ„ì  ë°©ì‹
```

#### 4. CrossStakingRouter
```solidity
// ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ (ì¬ë°°í¬ ê°€ëŠ¥)
- stakeNative() / unstakeNative()
- stakeERC20() / unstakeERC20()
- ìë™ ë˜í•‘/ì–¸ë˜í•‘
```

---

## ğŸ”„ ì‚¬ìš© í”Œë¡œìš°

### Native CROSS ìŠ¤í…Œì´í‚¹

```
1. User â†’ Router.stakeNative{value: 100}(poolId)
2. Router â†’ WCROSS.deposit{value: 100}()
3. Router â†’ Pool.stakeFor(user, 100)
4. Userì˜ ìŠ¤í…Œì´í‚¹ ê¸°ë¡ë¨
```

### ë³´ìƒ ë¶„ë°°

```
1. ëˆ„êµ¬ë‚˜ â†’ rewardToken.transfer(pool, 1000)
2. ë‹¤ìŒ ì‚¬ìš©ì ì•¡ì…˜ ì‹œ _syncReward() ìë™ ê°ì§€
3. rewardPerTokenStored ì—…ë°ì´íŠ¸
4. ì‚¬ìš©ìë³„ ë³´ìƒ ê³„ì‚°
```

### ì–¸ìŠ¤í…Œì´í‚¹

```
1. User â†’ Router.unstakeNative(poolId)
2. Router â†’ Pool.unstakeFor(user)
3. WCROSS + ë³´ìƒì´ userì—ê²Œ ì „ì†¡ë¨
4. Router â†’ userì˜ WCROSSë¥¼ ê°€ì ¸ì˜´
5. Router â†’ WCROSSë¥¼ Native CROSSë¡œ ì–¸ë˜í•‘
6. User â†’ Native CROSS + ë³´ìƒ ìˆ˜ë ¹
```

---

## ğŸ“Š í…ŒìŠ¤íŠ¸ ê²°ê³¼

```
â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€+â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ Test Suite                      | Passed â”‚
+â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•+â•â•â•â•â•â•â•â•+
â”‚ WCROSS                          |   10   â”‚
â”‚ CrossStaking                    |   33   â”‚
â”‚ CrossStakingRouter              |   15   â”‚
â”‚ FullIntegration                 |    9   â”‚
â”‚ CrossStakingPool (All)          |   92   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€+â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Total                           |  159   â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€+â”€â”€â”€â”€â”€â”€â”€â”€â•¯

ì„±ê³µë¥ : 100% (159/159)
ì»¤ë²„ë¦¬ì§€: ~100%
```

### í…ŒìŠ¤íŠ¸ ì¹´í…Œê³ ë¦¬

- **ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸**: ë˜í•‘, í’€ ìƒì„±, ìŠ¤í…Œì´í‚¹, ë³´ìƒ
- **í†µí•© í…ŒìŠ¤íŠ¸**: ì „ì²´ ì‹œìŠ¤í…œ í”Œë¡œìš°
- **ë³´ì•ˆ í…ŒìŠ¤íŠ¸**: ì¬ì§„ì…, ê¶Œí•œ, ë¶ˆë³€ì„±
- **ì—ì§€ ì¼€ì´ìŠ¤**: ê²½ê³„ê°’, ì˜ˆì™¸ ìƒí™©

---

## ğŸ” ë³´ì•ˆ íŠ¹ì§•

### 7ê°œ ë³´ì•ˆ ê³„ì¸µ

```
Layer 1: ReentrancyGuardTransient (ì¬ì§„ì… ë°©ì§€)
Layer 2: SafeERC20 (ì•ˆì „í•œ ì „ì†¡)
Layer 3: AccessControl (ì—­í•  ê¸°ë°˜ ê¶Œí•œ)
Layer 4: Pausable (ê¸´ê¸‰ ì •ì§€)
Layer 5: UUPS (ì•ˆì „í•œ ì—…ê·¸ë ˆì´ë“œ)
Layer 6: Custom Errors (íƒ€ì… ì•ˆì „)
Layer 7: Router Check (ê¶Œí•œ ê²€ì¦)
```

### ê¶Œí•œ ë¶„ë¦¬

**CrossStaking:**
- DEFAULT_ADMIN_ROLE: ì‹œìŠ¤í…œ ê´€ë¦¬
- POOL_MANAGER_ROLE: í’€ ìƒì„±/ê´€ë¦¬

**CrossStakingPool:**
- DEFAULT_ADMIN_ROLE: í’€ ê´€ë¦¬ (CrossStaking)
- REWARD_MANAGER_ROLE: ë³´ìƒ í† í° ê´€ë¦¬
- PAUSER_ROLE: ê¸´ê¸‰ ì •ì§€

---

## ğŸ’ í•µì‹¬ ê¸°ëŠ¥

### ì‚¬ìš©ì ê¸°ëŠ¥

- ğŸ’° **ìŠ¤í…Œì´í‚¹**: Native CROSS ë˜ëŠ” ERC20
- ğŸ“¤ **ì–¸ìŠ¤í…Œì´í‚¹**: í† í° + ë³´ìƒ ìˆ˜ë ¹
- ğŸ **ë³´ìƒ ì¡°íšŒ**: ì‹¤ì‹œê°„ ë³´ìƒ í™•ì¸
- âœ¨ **ë³´ìƒ ìˆ˜ë ¹**: ê°œë³„/ì „ì²´ ë³´ìƒ

### ê´€ë¦¬ì ê¸°ëŠ¥

- â• **í’€ ìƒì„±**: í† í°ë³„ í’€ ìƒì„±
- ğŸ’ **ë³´ìƒ í† í° ì¶”ê°€**: ë‹¤ì¤‘ ë³´ìƒ ì„¤ì •
- â¸ï¸ **í’€ í™œì„±í™”/ë¹„í™œì„±í™”**: ê¸´ê¸‰ ì •ì§€
- ğŸ”„ **Router ì„¤ì •**: Router êµì²´

---

## ğŸ“– ë¬¸ì„œ

- [ê°œìš”](overview/00_overview.md) - ë¹ ë¥¸ ì‹œì‘
- [Architecture](overview/01_architecture.md) - ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜
- [Reward Mechanism](overview/02_reward_mechanism.md) - ë³´ìƒ ë©”ì»¤ë‹ˆì¦˜
- [Security & Testing](overview/03_security_and_testing.md) - ë³´ì•ˆ ë° í…ŒìŠ¤íŠ¸
- [Test Guide](test/README.md) - í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ

---

## ğŸ”„ ì—…ê·¸ë ˆì´ë“œ

### CrossStaking

```solidity
CrossStaking newImpl = new CrossStaking();
crossStaking.upgradeToAndCall(address(newImpl), "");
```

### Pool

```solidity
CrossStakingPool newImpl = new CrossStakingPool();
pool.upgradeToAndCall(address(newImpl), "");
```

### Router

```solidity
CrossStakingRouter newRouter = new CrossStakingRouter(address(crossStaking));
crossStaking.setRouter(address(newRouter));
```

---

## ğŸ“ˆ Gas íš¨ìœ¨

| í•¨ìˆ˜ | Gas | ìƒíƒœ |
|------|-----|------|
| stakeNative | ~177k | âœ… |
| unstakeNative | ~235k | âœ… |
| stakeERC20 | ~135k | âœ… |
| stake | ~143k | âœ… |
| unstake | ~288k | âœ… |

**ìµœì í™” ê¸°ë²•:**
- EnumerableSet (O(1) lookup)
- ReentrancyGuardTransient
- Helper í•¨ìˆ˜ ì¬ì‚¬ìš©
- Custom Errors

---

## ğŸ›¡ï¸ ê°ì‚¬ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [x] 159ê°œ í…ŒìŠ¤íŠ¸ 100% í†µê³¼
- [x] ì¬ì§„ì… ê³µê²© ë°©ì–´
- [x] ê¶Œí•œ ê²€ì¦
- [x] ë¶ˆë³€ì„± ì²´í¬
- [x] Gas ìµœì í™”
- [ ] ì™¸ë¶€ ê°ì‚¬ (ê¶Œì¥)

---

## ğŸ“œ ë¼ì´ì„ ìŠ¤

MIT

## ğŸ”— ê´€ë ¨ ë§í¬

- [OpenZeppelin Contracts](https://docs.openzeppelin.com/contracts/)
- [Foundry Book](https://book.getfoundry.sh/)

---

**ë²„ì „:** 1.0.0  
**ìƒíƒœ:** Production Ready âœ…
